{% extends '_layout.html' %} 

{% block title %} New Post {% endblock %}

{% block body %}

{% block extra_css %}
<style>
    #caption, #title{ 
        display: block;
        margin-left: auto;
        margin-right: auto;
    }

    h1{
    text-align: center;
    }

    canvas { border: 5px solid black}
</style>
{% endblock %}


<script>
    document.addEventListener("DOMContentLoaded", function () {
        const gCanvas = document.querySelector('#c');
        const gCtx = gCanvas.getContext('2d');

        function onMouseDown(e) {
            e.preventDefault();
            window.addEventListener('mousemove', onMouseMove);
            window.addEventListener('mouseup', onMouseUp);
        }

        function onMouseMove(e){
            e.preventDefault();
            gCtx.fillRect(e.offsetX - 4, e.offsetY - 4, 8, 8);   
        }

        function onMouseUp(e){
            e.preventDefault();
            window.removeEventListener('mousemove', onMouseMove);
            window.removeEventListener('mouseup', onMouseUp);
        }

        function onSave() {
            const imageDataURL = gCanvas.toDataURL();
            const base64Data = imageDataURL.split(',')[1];

            const postData = {
                title: document.getElementById('title').value,
                description: document.getElementById('description').value,
                image: base64Data
            }

            // Make the POST request using the Fetch API
            fetch('/posts/generate', {
                    method: 'POST',
                    headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(postData)
            })
            .then(response => response.json())
            .then(data => {
                // Handle the response data as needed
                console.log('Response:', data);

                // Optionally, display a message to the user
                alert('Fruit created successfully!');
            })
            .catch(error => {
                // Handle any errors that occurred during the fetch
                console.error('Error:', error);
            });
        }

        gCanvas.addEventListener("mousedown", onMouseDown);
        document.querySelector('#save').addEventListener('click', onSave);
    });         
</script>


<body>
    <canvas id = "c" width = "500" height = "500"></canvas>
</body>

<div class="new-post-container">
    <textarea id = "title" name = "title" rows = "2" cols = "133"></textarea>
    <br>
    <textarea id = "description" name ="description" rows = "15" cols = "133"></textarea>
    <div class = "text-center">
        <br>
        <button type="button" class="btn btn-success">POST</button>    
        <a href = "/" class="btn btn-danger">CANCEL</a>
    </div>
</div>

{% endblock %}